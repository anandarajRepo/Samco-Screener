<!DOCTYPE html>
<html>
<head>
 <title></title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script>
    $(document).ready(function() {
        $('input[name="insturmentId"]').click(function() {
            var stockId;
            if ($(this).is(":checked")) {
                console.log('Checked');
                console.log($(this).val());
                stockId = $(this).val();
                $.ajax({
                    method: "POST",
                    url: "/insert",
                    data: {'data':$(this).val(), 'event': true},
                    cache: false,
                    success: function(data){
                        $("#result").html(data);
                    }
		        });
            } else {
                console.log('Unchecked');
                console.log($(this).val());
                stockId = $(this).val();
                $.ajax({
                    method: "POST",
                    url: "/insert",
                    data: {'data':$(this).val(), 'event': false},
                    cache: false,
                    success: function(data){
                        $("#result").html(data);
                    }
		        });
            }

        });

        $('#sector-dropdown').on('change', function() {
            $("#sub-category-dropdown").html("");
            var sectorName = $(this).val();
            console.log(sectorName)
            $.ajax({
                url: "/fetchSubSector",
                type: "POST",
                data: {
                    sectorName: sectorName
                },
                cache: false,
                success: function(data) {
                    var output = "";
                    console.log(data.subsector)
                    $.each(data.subsector, function(key, val){
                        output += "<option value='"+val+"'>"+val+"</option>"
                    });
                    $("#sub-category-dropdown").append(output);
                }
            });
        });

    });
</script>
<style>
.column-nowrap {
    white-space: nowrap;
}

.sticky-header {
    position: sticky;
    top:0;
    background: white;
    z-index: 1;
}

.sticky-header-company {
    position: sticky;
    left:0;
    background: white;
    z-index: 2;
}

.positive {
    color:green;
    font-weight:bold;
}

.negative {
    color:#CD5C5C;
    font-weight:bold;
}

table thead th {
  position: sticky;
  top: 0;
  z-index: 1;
  background: white;
}

table thead th:first-child {
  position: sticky;
  left: 0;
  z-index: 3;
}

table thead th:nth-child(2) {
  position: sticky;
  top: 0;
  z-index: 2;
}

table tbody th:first-child {
  position: sticky;
  left: 0;
  background: white;
  z-index: 1;
}

.list-group {

}
</style>
<body>
<br/>
<form class="form-inline" method="POST" action="{{ url_for('home') }}">
    <div class="form-group">
        <div class="input-group">
            <select class="form-select"  id="sector-dropdown" name="sector-dropdown" aria-label="Default select example">
                {% for sectorDetails in listOfSectors %}
                  <option value="{{sectorDetails['sector']}}">{{sectorDetails['sector']}}</option>
                {% endfor %}
            </select>

            <select class="form-select"  id="sub-category-dropdown" name="sub-category-dropdown" aria-label="Default select example">
            </select>
        </div>
        <button type="submit" class="btn btn-default">Go</button>
    </div>
</form>
<br/>

<table class="table table-light">
    <thead>
        <tr>
            <th scope="col">ID</th>
            <th scope="col">Company</th>
            <th scope="col">Sector</th>
            <th scope="col">Sub-Sector</th>
            <th scope="col">1M %Returns</th>
        </tr>
    </thead>
    <tbody>
        {% for stockDetails in listOfStocks %}
            <tr>
                <th><input type="checkbox" class="get_value" name="insturmentId" value="{{stockDetails['id']}}" {% if stockDetails['favourite'] == true %} checked {% endif %}></th>
                <th scope="row">{{stockDetails['nameofcompany']}}</th>
                <td scope="row">{{stockDetails['sector']}}</td>
                <td scope="row">{{stockDetails['subsector']}}</td>
                <td scope="row"><b>{{stockDetails['returns']}}</b></td>
            </tr>
        {% endfor %}
    </tbody>
</table>
<button type="button" name="submit" id="submit" class="btn btn-primary btn-lg btn-block">Save Favourite Stocks</button>
<br/>
<h4 id="result" class="alert alert-success"></h4>

<!-- Optional JavaScript; choose one of the two! -->
<!-- Option 1: Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<!-- Option 2: Separate Popper and Bootstrap JS -->
<!--
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
-->
</body>
</html>
